-- 数据初始化

TRUNCATE TABLE t_monthly_order_amount;

--  数据生成

insert into t_monthly_order_amount( fin_period , actual_paid , alipay_actual_recieve , refund , order_fee , account_fee , alipay_get) select order_date , sum(actual_paid) , sum(alipay_actual_recieve) , sum(refund) , sum(order_fee) , sum(account_fee) , sum(alipay_get) from( SELECT SUBSTR(create_time FROM 1 FOR 10) as order_date , sum(actual_paid) as actual_paid , 0 AS alipay_actual_recieve , 0 as refund , 0 AS order_fee , 0 AS account_fee , 0 AS alipay_get FROM load_tmallso_info GROUP BY SUBSTR(create_time FROM 1 FOR 10) UNION SELECT SUBSTR(payment_time FROM 1 FOR 10) as order_date , 0 AS actual_paid , sum(rmb_amount) AS alipay_actual_recieve , sum(refund * Rate) as refund , 0 AS order_fee , 0 AS account_fee , 0 AS alipay_get FROM load_strade_info GROUP BY order_date UNION SELECT SUBSTR(payment_time FROM 1 FOR 10) as order_date , 0 AS actual_paid , 0 AS alipay_actual_recieve , 0 as refund , sum(fee_amount) as order_fee , 0 AS account_fee , 0 AS alipay_get FROM load_fee_info GROUP BY order_date union SELECT SUBSTR(Trans_Date FROM 1 FOR 10) as order_date , 0 AS actual_paid , 0 AS alipay_actual_recieve , 0 as refund , 0 as order_fee , sum(amount) AS account_fee , 0 AS alipay_get FROM load_myaccount_info GROUP BY order_date union SELECT SUBSTR(Settlement_time FROM 1 FOR 10) as order_date , 0 AS actual_paid , 0 AS alipay_actual_recieve , 0 as refund , 0 as order_fee , 0 AS account_fee , sum(Rmb_settlement) AS alipay_get FROM load_settledetails_info GROUP BY order_date union SELECT SUBSTR(Settlement_time FROM 1 FOR 10) as order_date , 0 AS actual_paid , 0 AS alipay_actual_recieve , ABS(sum(Rmb_amount)) as refund , 0 as order_fee , 0 AS account_fee , 0 AS alipay_get FROM load_settledetails_info where Type = 'R' GROUP BY order_date) as t GROUP BY order_date;

