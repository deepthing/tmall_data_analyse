TRUNCATE TABLE t_myaccount_monthly_info;

insert into t_myaccount_monthly_info( period , recharge , refund , payment , order_payment , not_order_payment) select trans_date , sum(recharge) , sum(refund) , sum(payment) , sum(order_payment) , sum(not_order_payment) from( select SUBSTR(Trans_Date FROM 1 FOR 10) as trans_date , sum(Amount) as recharge , 0 as refund , 0 as payment , 0 as order_payment , 0 as not_order_payment from load_myaccount_info where type = 'recharge' GROUP BY SUBSTR(Trans_Date FROM 1 FOR 10) UNION select SUBSTR(Trans_Date FROM 1 FOR 10) , 0 , sum(Amount) as refund , 0 , 0 , 0 from load_myaccount_info where type = 'refund' GROUP BY SUBSTR(Trans_Date FROM 1 FOR 10) UNION select SUBSTR(Trans_Date FROM 1 FOR 10) , 0 , 0 , sum(Amount) as payment , 0 , 0 from load_myaccount_info where type = 'payments' GROUP BY SUBSTR(Trans_Date FROM 1 FOR 10) UNION select SUBSTR(Trans_Date FROM 1 FOR 10) , 0 , 0 , 0 , sum(Amount) as order_payment , 0 from load_myaccount_info where type = 'payments' and LENGTH(Partner_Transaction_ID) > 10 GROUP BY SUBSTR(Trans_Date FROM 1 FOR 10) UNION select SUBSTR(Trans_Date FROM 1 FOR 10) , 0 , 0 , 0 , 0 , sum(Amount) as not_order_payment from load_myaccount_info where type = 'payments' and LENGTH(Partner_Transaction_ID) < 10 GROUP BY SUBSTR(Trans_Date FROM 1 FOR 10)) as T GROUP BY trans_date;

