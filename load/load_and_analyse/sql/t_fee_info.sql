UPDATE load_fee_info SET Partner_transaction_id = trim('\t' from Partner_transaction_id);

TRUNCATE table t_fee_info;

insert into t_fee_info( order_id , fee_time , payment_time , logisitic_tax , logisitic_service , alipay_service , tmall , juhuasuan , order_fee , account_fee , logisitic_tax_usd , logisitic_service_usd , alipay_service_usd , tmall_usd , juhuasuan_usd , order_fee_usd , account_fee_usd) SELECT order_id , Fee_date , Payment_date , sum(logisitic_tax) , sum(logisitic_service) , SUM(alipay_service) , sum(tmall) , sum(juhuasuan) , sum(order_fee) , sum(account_fee) , sum(logisitic_tax_usd) , sum(logisitic_service_usd) , SUM(alipay_service_usd) , sum(tmall_usd) , sum(juhuasuan_usd) , sum(order_fee_usd) , sum(account_fee_usd) from( SELECT a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , a.Fee_amount AS logisitic_tax , 0 as logisitic_service , 0 AS alipay_service , 0 AS tmall , 0 AS juhuasuan , 0 AS order_fee , 0 AS account_fee , a.Foreign_fee_amount AS logisitic_tax_usd , 0 AS logisitic_service_usd , 0 AS alipay_service_usd , 0 AS tmall_usd , 0 AS juhuasuan_usd , 0 AS order_fee_usd , 0 AS account_fee_usd FROM load_fee_info a , t_order_amount b WHERE a.Partner_transaction_id = b.order_id AND a.fee_desc LIKE '%进口关税%' UNION SELECT a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 , 0 , 0 , 0 FROM load_fee_info a , t_order_amount b WHERE a.Partner_transaction_id = b.order_id AND a.Fee_desc like '菜鸟-保税_正向配送费%' UNION SELECT a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 , 0 , 0 , 0 FROM load_fee_info a , t_order_amount b WHERE a.Partner_transaction_id = b.order_id AND a.fee_desc LIKE '%服务费用%' UNION SELECT a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 , 0 , 0 FROM load_fee_info a , t_order_amount b WHERE a.Partner_transaction_id = b.order_id AND a.fee_desc like '%Alipay service fee%' UNION select a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , 0 , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 , 0 from load_fee_info a , t_order_amount b where a.Partner_transaction_id = b.order_id and a.fee_desc like '%Tmall Global Commission%' UNION select a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , 0 , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 , 0 from load_fee_info a , t_order_amount b where a.Partner_transaction_id = b.order_id and a.fee_desc like '%天猫收佣金%' UNION select a.Partner_transaction_id as order_id , a.Fee_date , substr(a.Payment_time , 1 , 10) as Payment_date , 0 , 0 , 0 , 0 , a.Fee_amount , 0 , 0 , 0 , 0 , 0 , 0 , a.Foreign_fee_amount , 0 , 0 from load_fee_info a , t_order_amount b where a.Partner_transaction_id = b.order_id and a.fee_desc like '%Juhuasuan Overseas Commission%' UNION select b.order_id , SUBSTR(b.fin_period FROM 1 FOR 10) as Fee_date , SUBSTR(b.fin_period FROM 1 FOR 10) as Payment_date , 0 , 0 , 0 , 0 , 0 , b.order_fee , b.account_fee , 0 , 0 , 0 , 0 , 0 , 0 , b.account_fee_usd from t_order_amount b) as t group by order_id , fee_date , Payment_date;